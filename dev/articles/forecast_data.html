<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example forecast hub data • hubExamples</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example forecast hub data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://hubdocs.readthedocs.io/en/latest/" class="external-link"><img src="https://raw.githubusercontent.com/hubverse-org/hubStyle/main/inst/hubverse.png" id="logo" height="30" alt="hubverse"></a>
    <a class="navbar-brand me-2" href="../index.html">hubExamples</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/forecast_data.html">Example forecast hub data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hubverse-org/hubExamples/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example forecast hub data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hubverse-org/hubExamples/blob/main/vignettes/forecast_data.Rmd" class="external-link"><code>vignettes/forecast_data.Rmd</code></a></small>
      <div class="d-none name"><code>forecast_data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hubverse-org/hubExamples" class="external-link">hubExamples</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hubverse-org/hubVis" class="external-link">hubVis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>hubExamples</code> package provides three data sets that
contain example model output and target data for an example forecast
hub: <code>forecast_outputs</code>, <code>forecast_target_ts</code>, and
<code>forecast_oracle_output</code>. These forecasts and target data are
a subset of the model outputs and target data that are provided in the
<a href="https://github.com/hubverse-org/example-complex-forecast-hub" class="external-link">example-complex-forecast-hub</a>.
These data were in turn derived from forecast submissions and target
data for the <a href="https://github.com/cdcepi/Flusight-forecast-data" class="external-link">FluSight
Forecast Hub</a> for the 2022/23 season.</p>
<p>We begin with a high level overview of these data objects and then we
describe the different forecast targets in more detail.</p>
<div class="section level3">
<h3 id="example-forecast-output-data">Example forecast output data<a class="anchor" aria-label="anchor" href="#example-forecast-output-data"></a>
</h3>
<p>The example forecasts provided in <code>forecast_outputs</code> are
derived from forecasts that were submitted to the FluSight hub from
three models: <code>Flusight-baseline</code>,
<code>MOBS-GLEAM_FLUH</code>, and <code>PSI-DICE</code>. The original
forecasts submitted to the hub were in quantile format, but we have
modified those submissions to provide examples of additional model
output types and targets. The predictions for these other output types
should be viewed only as illustrations of the data formats, not as real
examples of forecasts. We will describe the methods used for creating
other forecast output types below.</p>
<p>The snippet below shows the format of the
<code>forecast_outputs</code> (note: here and throughout the document,
you may need to scroll to the right within displays of code output to
see all data frame columns).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">forecast_outputs</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   model_id          reference_date target          horizon location target_end_date output_type output_type_id value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.05              22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.1               31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.25              45</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.5               51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.75              57</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Flusight-baseline 2022-11-19     wk inc flu hosp       0 25       2022-11-19      quantile    0.9               71</span></span></code></pre></div>
<p>This is a data frame with four groups of columns (see the <a href="https://hubverse.io/en/latest/user-guide/model-output.html" class="external-link">hubverse
documentation</a> for more information about these data formats):</p>
<ol style="list-style-type: decimal">
<li>The <code>model_id</code> identifies the model that produced the
predictions.</li>
<li>Together, the <code>location</code>, <code>reference_date</code>,
<code>horizon</code>, <code>target_end_date</code>, and
<code>target</code> columns are referred to as “task id variables”
because they serve to identify a prediction task:
<ul>
<li>The <code>location</code> column contains a FIPS code identifying
the location being predicted.</li>
<li>The <code>reference_date</code> is a date in ISO format that gives
the Saturday ending the week the predictions were generated.</li>
<li>The <code>horizon</code> gives the difference between the
<code>reference_date</code> and the target date of the forecasts
(<code>target_end_date</code>, see next item) in units of weeks.
Informally, this describes “how far ahead” the predictions are
targeting.</li>
<li>The <code>target_end_date</code> is a date in ISO format that gives
the Saturday ending the week being predicted. For example, if the
<code>target_end_date</code> is <code>"2022-12-17"</code>, predictions
are for a quantity relating to influenza activity in the week from
Sunday, December 11, 2022 through Saturday, December 17, 2022.</li>
<li>The <code>target</code> describes the target quantity for the
prediction. In the above example, the <code>target</code> of
<code>"wk flu hosp rate"</code> is the weekly rate of hospital
admissions per 100,000 population. The targets included in this example
will be described in other sections below.</li>
</ul>
</li>
<li>The <code>output_type</code> and <code>output_type_id</code> columns
provide metadata about the model predictions.
<ul>
<li>The <code>output_type</code> specifies the representation of the
predictive distribution.</li>
<li>The <code>output_type_id</code> gives additional identifying
information about the predictions; the information in this column is
specific to the <code>output_type</code>.</li>
</ul>
</li>
<li>The <code>value</code> column contains the value of the model’s
prediction.</li>
</ol>
<p>The original hub submissions contained predictions for many locations
and dates, and quantile forecasts were provided at 23 different quantile
levels ranging from 0.01 to 0.99. To make the example data more
manageable, the <code>forecast_outputs</code> object contains a subset
of these outputs for two locations (Massachusetts, FIPS code
<code>"25"</code>, and Texas, FIPS code <code>"48"</code>) and two
reference dates (2022-11-19 and 2022-12-17). Additionally, for the
quantile forecasts we have subset to seven quantile levels: 0.05, 0.1,
0.25, 0.5, 0.75, 0.9, and 0.95.</p>
<p>The task id variables used and values of those variables are specific
to each modeling hub. For example, a hub collecting predictions for
locations other than US states would use a different location identifier
than FIPS codes, and a hub might introduce additional task id variables
such as an identifier of age group or disease variant depending on the
goals of the hub. See the hubverse documentation for further information
about <a href="https://hubverse.io/en/latest/user-guide/tasks.html#task-id-variables" class="external-link">task
id variables</a>.</p>
</div>
<div class="section level3">
<h3 id="example-forecast-target-data">Example forecast target data<a class="anchor" aria-label="anchor" href="#example-forecast-target-data"></a>
</h3>
<p>All predictions are for targets that are based on influenza hospital
admissions as reported in the US National Healthcare Safety Network
(NHSN). The <code>forecast_target_ts</code> object contains the observed
values of these hospital admissions in a time series format:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">forecast_target_ts</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   date       location observation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020-01-11 01                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020-01-11 15                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2020-01-11 18                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2020-01-11 27                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2020-01-11 30                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2020-01-11 37                 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">forecast_target_ts</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   date       location observation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2023-11-11 51                88</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2023-11-11 50                 3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2023-11-11 53                20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2023-11-11 55                19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2023-11-11 54                12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2023-11-11 56                 7</span></span></code></pre></div>
<p>The <code>forecast_oracle_output</code> object contains the observed
values for the prediction targets:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">forecast_oracle_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   location target_end_date target          output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> US       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">2</span>380</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 01       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                      141</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 02       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 04       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 05       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                       50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 06       2022-10-22      wk inc flu hosp quantile    <span style="color: #BB0000;">NA</span>                      124</span></span></code></pre></div>
<p>This data frame has a subset of the columns in the
<code>forecast_outputs</code> that is sufficient to identify the
observed value corresponding to each prediction, including the
<code>location</code>, <code>target_end_date</code>,
<code>target</code>, <code>output_type</code>, and
<code>output_type_id</code>, along with the observed target values,
recorded in the <code>oracle_value</code> column. Note that the
<code>reference_date</code> and <code>horizon</code> columns are not
needed in this data frame, since the <code>target_end_date</code> is
sufficient to align observations with predictions.</p>
</div>
</div>
<div class="section level2">
<h2 id="further-detail-on-the-forecast-targets">Further detail on the forecast targets<a class="anchor" aria-label="anchor" href="#further-detail-on-the-forecast-targets"></a>
</h2>
<p>The example forecast data contains the following combinations of
<code>target</code> and <code>output_type</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">target</span>, <span class="va">output_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">target</span>, <span class="va">output_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   target                    output_type</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> wk flu hosp rate          cdf        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> wk flu hosp rate category pmf        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> wk inc flu hosp           mean       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> wk inc flu hosp           median     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> wk inc flu hosp           quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> wk inc flu hosp           sample</span></span></code></pre></div>
<p>We will describe each of these targets in the following sections.</p>
<div class="section level3">
<h3 id="the-wk-inc-flu-hosp-target">The <code>wk inc flu hosp</code> target<a class="anchor" aria-label="anchor" href="#the-wk-inc-flu-hosp-target"></a>
</h3>
<p>The <code>wk inc flu hosp</code> target represents weekly new
hospital admissions with a confirmed influenza diagnosis. We have
predictions of this target with four output types: <code>mean</code>,
<code>median</code>, <code>quantile</code> and <code>sample</code>. Note
that the quantile predictions were contributed directly by modelers to
the FluSight hub, and median predictions correspond exactly to the
quantile predictions at probability level 0.5. We have obtained sample
predictions from the quantile forecasts using the <a href="https://github.com/reichlab/distfromq" class="external-link">distfromq package</a> by
estimating the full quantile function from the submitted quantile
predictions for each individual location and target date, drawing
samples from those marginal distributions using the probability integral
transform method, and using a copula corresponding to a discrete-time
AR(0.9) Gaussian process to induce dependence across sequential
horizons. Mean predictions are obtained as the mean of samples drawn for
each location and target date combination.</p>
<p>The following plot shows the quantile and median predictions along
with the observed hospital admission counts for Massachusetts and
Texas.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://hubverse-org.github.io/hubVis/reference/plot_step_ahead_model_output.html" class="external-link">plot_step_ahead_model_output</a></span><span class="op">(</span></span>
<span>  model_out_tbl <span class="op">=</span> <span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quantile"</span>, <span class="st">"median"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  target_data <span class="op">=</span> <span class="va">forecast_target_ts</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"25"</span>, <span class="st">"48"</span><span class="op">)</span>,</span>
<span>           <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2022-10-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2023-04-01"</span><span class="op">)</span>,</span>
<span>  use_median_as_point <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  x_col_name <span class="op">=</span> <span class="st">"target_end_date"</span>,</span>
<span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  facet <span class="op">=</span> <span class="st">"location"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"reference_date"</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> `output_type_id` column must be a numeric. Converting to numeric.</span></span></code></pre></div>
<p><img src="forecast_data_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The following plot shows the target data and predictive samples for
just predictions for Massachusetts with reference date December 17, 2022
generated by the “MOBS-GLEAM_FLUH” model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecast_target_ts</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span>,</span>
<span>             <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2022-10-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2023-04-01"</span><span class="op">)</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">observation</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span>,</span>
<span>        <span class="va">model_id</span> <span class="op">==</span> <span class="st">"MOBS-GLEAM_FLUH"</span>,</span>
<span>        <span class="va">reference_date</span> <span class="op">==</span> <span class="st">"2022-12-17"</span>,</span>
<span>        <span class="va">output_type</span> <span class="op">==</span> <span class="st">"sample"</span></span>
<span>      <span class="op">)</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">target_end_date</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">output_type_id</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_data_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
<p>For purposes of evaluating predictions, it can be helpful to join the
observed target values, contained in
<code>forecast_oracle_output</code>, into the data frame of forecast
outputs. This enables direct comparison of predictions and observations.
We illustrate this here, omitting some columns from the display for
convenience:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">target</span> <span class="op">==</span> <span class="st">"wk inc flu hosp"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">forecast_oracle_output</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">model_id</span>, <span class="op">-</span><span class="va">reference_date</span>, <span class="op">-</span><span class="va">horizon</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(target, location, target_end_date, output_type, output_type_id)`</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,232 × 7</span></span></span>
<span><span class="co">#&gt;    target          location target_end_date output_type output_type_id value oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> wk inc flu hosp 25       2022-11-19      quantile    0.05              22           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> wk inc flu hosp 25       2022-11-19      quantile    0.1               31           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> wk inc flu hosp 25       2022-11-19      quantile    0.25              45           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> wk inc flu hosp 25       2022-11-19      quantile    0.5               51           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> wk inc flu hosp 25       2022-11-19      quantile    0.75              57           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> wk inc flu hosp 25       2022-11-19      quantile    0.9               71           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> wk inc flu hosp 25       2022-11-19      quantile    0.95              80           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> wk inc flu hosp 25       2022-11-26      quantile    0.05               5           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> wk inc flu hosp 25       2022-11-26      quantile    0.1               21           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> wk inc flu hosp 25       2022-11-26      quantile    0.25              38           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,222 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-wk-flu-hosp-rate-target">The <code>wk flu hosp rate</code> target<a class="anchor" aria-label="anchor" href="#the-wk-flu-hosp-rate-target"></a>
</h3>
<p>The <code>wk flu hosp rate</code> target represents the rate of
weekly confirmed influenza hospital admissions per 100,000 population.
Note that this target was not included in the FluSight hub; we have
introduced it here for illustrative purposes. We have used population
values of 6,978,662 for Massachusetts and 29,914,599 for Texas. These
population values are sourced from the <a href="https://github.com/cdcepi/FluSight-forecast-hub/blob/main/auxiliary-data/locations.csv" class="external-link">auxiliary
data file</a> provided by the FluSight hub, which are also reproduced in
the <a href="https://github.com/hubverse-org/example-complex-forecast-hub" class="external-link">example-complex-forecast-hub</a>
repository.</p>
<p>For this target, we created cumulative distribution function (CDF)
predictions with evenly spaced CDF evaluation points ranging from 0.25
to 25 in increments of 0.25 hospitalizations per 100,000 population:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">target</span> <span class="op">==</span> <span class="st">"wk flu hosp rate"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">model_id</span>, <span class="op">-</span><span class="va">reference_date</span>, <span class="op">-</span><span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   target           location target_end_date output_type output_type_id  value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> wk flu hosp rate 25       2022-11-19      cdf         0.25           0.040<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> wk flu hosp rate 25       2022-11-19      cdf         0.5            0.131 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> wk flu hosp rate 25       2022-11-19      cdf         0.75           0.568 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> wk flu hosp rate 25       2022-11-19      cdf         1              0.891 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> wk flu hosp rate 25       2022-11-19      cdf         1.25           0.965 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> wk flu hosp rate 25       2022-11-19      cdf         1.5            0.985</span></span></code></pre></div>
<p>For the CDF <code>output_type</code>, the <code>output_type_id</code>
contains the value at which the predictive CDF was evaluated, and the
<code>value</code> contains the predicted probability that the target is
less than or equal to that evaluation point. In the above example, the
<code>value</code> in the row with <code>output_type_id</code> equal to
1.5 contains the model’s estimated probability that the rate of hospital
admissions in Texas the week of December 17, 2022 would be less than or
equal to 1.5 admissions per 100,000 population. Again, these CDF values
were estimated from the original quantile forecasts using the methods in
the <code>distfromq</code> package.</p>
<p>The following plot illustrates the predictive CDFs produced by the
<code>MOBS-GLEAM_FLUH</code> model for Massachusetts on the reference
date 2022-12-17, with each <code>target_end_date</code> shown in a
separate facet. Also shown in orange is a CDF representing the
observation for this target, which was between 9.75 and 10
hospitalizations per 100,000 population. This CDF corresponds to a point
mass at the observed value, with a value of 0 below the observation and
a value of 1 above the observation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset the forecasts and oracle values to those that we will plot</span></span>
<span><span class="va">forecasts_to_plot</span> <span class="op">&lt;-</span> <span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">model_id</span> <span class="op">==</span> <span class="st">"MOBS-GLEAM_FLUH"</span>,</span>
<span>    <span class="va">target</span> <span class="op">==</span> <span class="st">"wk flu hosp rate"</span>,</span>
<span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span>,</span>
<span>    <span class="va">reference_date</span> <span class="op">==</span> <span class="st">"2022-12-17"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>output_type_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">output_type_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">forecasts_to_plot</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   model_id        reference_date target           horizon location target_end_date output_type output_type_id    value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   0.25 8.52<span style="color: #949494;">e</span><span style="color: #BB0000;">-21</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   0.5  1.63<span style="color: #949494;">e</span><span style="color: #BB0000;">-19</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   0.75 2.80<span style="color: #949494;">e</span><span style="color: #BB0000;">-18</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   1    4.37<span style="color: #949494;">e</span><span style="color: #BB0000;">-17</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   1.25 6.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> MOBS-GLEAM_FLUH 2022-12-17     wk flu hosp rate       0 25       2022-12-17      cdf                   1.5  7.87<span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span></span></span>
<span></span>
<span><span class="va">oracle_outputs_to_plot</span> <span class="op">&lt;-</span> <span class="va">forecast_oracle_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">target</span> <span class="op">==</span> <span class="st">"wk flu hosp rate"</span>,</span>
<span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span>,</span>
<span>    <span class="va">target_end_date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">forecasts_to_plot</span><span class="op">$</span><span class="va">target_end_date</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>output_type_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">output_type_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">oracle_outputs_to_plot</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   location target_end_date target           output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 25       2022-12-17      wk flu hosp rate cdf                   0.25            0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 25       2022-12-17      wk flu hosp rate cdf                   0.5             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 25       2022-12-17      wk flu hosp rate cdf                   0.75            0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 25       2022-12-17      wk flu hosp rate cdf                   1               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 25       2022-12-17      wk flu hosp rate cdf                   1.25            0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 25       2022-12-17      wk flu hosp rate cdf                   1.5             0</span></span>
<span></span>
<span><span class="co"># We illustrate that the cdf values recorded in forecast_oracle_output</span></span>
<span><span class="co"># correspond to a point mass at the observed hospitalization rate.</span></span>
<span><span class="va">first_one_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">oracle_outputs_to_plot</span><span class="op">$</span><span class="va">oracle_value</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">oracle_outputs_to_plot</span><span class="op">[</span><span class="op">(</span><span class="va">first_one_ind</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">first_one_ind</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   location target_end_date target           output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 25       2022-12-17      wk flu hosp rate cdf                   9.5             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 25       2022-12-17      wk flu hosp rate cdf                   9.75            0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 25       2022-12-17      wk flu hosp rate cdf                  10               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 25       2022-12-17      wk flu hosp rate cdf                  10.2             1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 25       2022-12-17      wk flu hosp rate cdf                  10.5             1</span></span>
<span></span>
<span><span class="co"># Make the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">output_type_id</span>, y <span class="op">=</span> <span class="va">value</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"forecast"</span>, linetype <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">forecasts_to_plot</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">output_type_id</span>, y <span class="op">=</span> <span class="va">oracle_value</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"oracle_value"</span>, linetype <span class="op">=</span> <span class="st">"oracle_value"</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">oracle_outputs_to_plot</span>,</span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    <span class="st">"CDF"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"orange"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span></span>
<span>    <span class="st">"CDF"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">target_end_date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"output_type_id (units are hospital admissions per 100,000 population)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"CDF value (units are probability)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_data_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="the-wk-flu-hosp-rate-category-target">The <code>wk flu hosp rate category</code> target<a class="anchor" aria-label="anchor" href="#the-wk-flu-hosp-rate-category-target"></a>
</h3>
<p>The “wk flu hosp rate category” target represents a categorical
intensity level of influenza activity, defined as “low” (hospital
admissions rate per 100,000
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≤</mo><annotation encoding="application/x-tex">\leq</annotation></semantics></math>
2.5), “moderate” (2.5 &lt; admissions rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≤</mo><annotation encoding="application/x-tex">\leq</annotation></semantics></math>
5), “high” (5 &lt; admissions rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≤</mo><annotation encoding="application/x-tex">\leq</annotation></semantics></math>
7.5), or “very high” (7.5 &lt; admissions rate). The
<code>forecast_outputs</code> object has example forecasts for this
target in a PMF format, with a probability assigned to each intensity
category. Again, forecasts of this target were not collected by the
FluSight hub; we have derived predictions from the submitted quantile
forecasts using the <code>distfromq</code> package. For context, the
following plot displays the observed data for the 2022/23 season on the
scale of hospital admissions per 100,000 population, with the boundaries
of the intensity categories denoted with horizontal lines:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a data frame containing location FIPS codes and population values</span></span>
<span><span class="co"># in units of 100,000 people</span></span>
<span><span class="va">population_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"25"</span>, <span class="st">"48"</span><span class="op">)</span>,</span>
<span>  population_100k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6978662</span>, <span class="fl">29914599</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute observed hospital admission rates for the 2022/23 season</span></span>
<span><span class="va">observed_rates</span> <span class="op">&lt;-</span> <span class="va">forecast_target_ts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"25"</span>, <span class="st">"48"</span><span class="op">)</span>,</span>
<span>         <span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2022-10-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2023-04-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">population_values</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">observation</span> <span class="op">/</span> <span class="va">population_100k</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(location)`</span></span>
<span></span>
<span><span class="co"># plot along with intensity thresholds</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">rate</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">observed_rates</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">7.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_data_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Here is a plot showing the predictive distributions for these targets
from the three included models. Color indicates the predicted
probability for each intensity category. The observed category is
indicated with a <code>+</code> in the plot, while unobserved categories
are indicated with an <code>o</code>. Here, the PMF value recorded in
<code>forecast_oracle_output</code> corresponds to a point mass at the
observed category, with a value of 1 for the observed category and a
value of 0 for the other categories.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract a subset of forecasts to plot and</span></span>
<span><span class="co"># set the output_type_id to be an ordered factor</span></span>
<span><span class="va">forecasts_to_plot</span> <span class="op">&lt;-</span> <span class="va">forecast_outputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">target</span> <span class="op">==</span> <span class="st">"wk flu hosp rate category"</span>,</span>
<span>    <span class="va">reference_date</span> <span class="op">==</span> <span class="st">"2022-12-17"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    output_type_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">output_type_id</span>,</span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>, <span class="st">"very high"</span><span class="op">)</span>,</span>
<span>                            ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">forecasts_to_plot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">model_id</span>, <span class="op">-</span><span class="va">reference_date</span>, <span class="op">-</span><span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   target                    location target_end_date output_type output_type_id      value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> wk flu hosp rate category 25       2022-12-17      pmf         low            0.000<span style="text-decoration: underline;">018</span>0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> wk flu hosp rate category 25       2022-12-17      pmf         moderate       0.001<span style="text-decoration: underline;">57</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> wk flu hosp rate category 25       2022-12-17      pmf         high           0.039<span style="text-decoration: underline;">7</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> wk flu hosp rate category 25       2022-12-17      pmf         very high      0.959     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> wk flu hosp rate category 25       2022-12-24      pmf         low            0.000<span style="text-decoration: underline;">009</span>70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> wk flu hosp rate category 25       2022-12-24      pmf         moderate       0.002<span style="text-decoration: underline;">94</span></span></span>
<span></span>
<span><span class="co"># extract the corresponding oracle values</span></span>
<span><span class="va">oracle_outputs_to_plot</span> <span class="op">&lt;-</span> <span class="va">forecast_oracle_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"25"</span>, <span class="st">"48"</span><span class="op">)</span>,</span>
<span>    <span class="va">target</span> <span class="op">==</span> <span class="st">"wk flu hosp rate category"</span>,</span>
<span>    <span class="va">target_end_date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">forecasts_to_plot</span><span class="op">$</span><span class="va">target_end_date</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    output_type_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">output_type_id</span>,</span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>, <span class="st">"very high"</span><span class="op">)</span>,</span>
<span>                            ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">oracle_outputs_to_plot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   location target_end_date target                    output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 25       2022-12-17      wk flu hosp rate category pmf         low                       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 25       2022-12-17      wk flu hosp rate category pmf         moderate                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 25       2022-12-17      wk flu hosp rate category pmf         high                      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 25       2022-12-17      wk flu hosp rate category pmf         very high                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 48       2022-12-17      wk flu hosp rate category pmf         low                       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 48       2022-12-17      wk flu hosp rate category pmf         moderate                  1</span></span>
<span></span>
<span><span class="co"># plot the predictions and oracle values</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">target_end_date</span>, y <span class="op">=</span> <span class="va">output_type_id</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">forecasts_to_plot</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">target_end_date</span>, y <span class="op">=</span> <span class="va">output_type_id</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">oracle_value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#888888"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>, stroke <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    data <span class="op">=</span> <span class="va">oracle_outputs_to_plot</span>,</span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">model_id</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"output_type_id (intensity level category)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_data_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Evan L Ray, Becky Sweger, Lucie Contamin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1. PR Previews built by <a href="https://www.netlify.com" class="external-link">Netlify</a>. Provided without <strong>any warranty</strong>.</p>
</div>

    </footer>
</div>





  </body>
</html>
